alter table preselect_rules add column sql_condition varchar(1000);
UPDATE preselect_rules SET sql_condition="select true where (select true where (select patient_id from patient_problems where patient_id = ? and name IN(\'angststoornis\',\'epilepsy\') limit 1) IS NULL) is not null and (select true where (select true from patient_medications where patient_id = ? and ((ATC_code like \'N05C%\' and ATC_code not like \'N05CH%\') or ATC_code like \'N05BA%\') and start_date >= CURRENT_DATE() - INTERVAL 2 WEEK ) is not null);" where id =1;
UPDATE preselect_rules SET sql_condition="select true where (select true where (select patient_id from patient_problems where patient_id = ? and name IN(\'angststoornis\',\'epilepsy\') limit 1) IS NULL) is not null and (select true where (select true from patient_medications where patient_id = ? and ((ATC_code like \'N05C%\' and ATC_code not like \'N05CH%\') or ATC_code like \'N05BA%\') and start_date < CURRENT_DATE() - INTERVAL 2 WEEK ) is not null);" where id =2;
UPDATE preselect_rules SET sql_condition="select true from (select name from patient_problems where patient_id = ? and name in(\'parkinson\',\'lewy-bodies-dementia\',\'multiple-system-atrophy\',\'progressive-supranuclear-palsy\')) as p;" where id =3;
UPDATE preselect_rules SET sql_condition="select true from patient_problems where !(\'angststoornis\' in (select name from patient_problems where patient_id = ?)) and !(\'depressie\' in (select name from patient_problems where patient_id = ?)) limit 1;" where id =7;
UPDATE preselect_rules SET sql_condition="select true where (select true from patient_problems where patient_id = ? and name = \'hartfalen\' limit 1) IS NULL;" where id =12;
UPDATE preselect_rules SET sql_condition="select true from patient_problems where !(select true from patient_problems where patient_id = ? and name = \'hartfalen\' limit 1) and !(select true from patient_problems where patient_id = ? and name = \'hypertensie\' limit 1) limit 1;" where id =13;
UPDATE preselect_rules SET sql_condition="select true from (select patient_labs.patient_id, lab_test_name, lab_test_result, name from patient_labs LEFT OUTER JOIN patient_problems on patient_labs.patient_id = patient_problems.patient_id where patient_labs.patient_id = ? AND ((lab_test_name = \'natrium\' AND cast(lab_test_result as decimal(5,2)) < 130) or (lab_test_name = \'kalium\' AND cast(lab_test_result as decimal(5,2)) < 3.0) or (lab_test_name = \'calcium\' AND cast(lab_test_result as decimal(5,2)) > 2.65)) UNION select patient_problems.patient_id, lab_test_name, lab_test_result, name from patient_problems LEFT OUTER JOIN patient_labs on patient_labs.patient_id = patient_problems.patient_id where patient_problems.patient_id = ? and name in(\'jicht\',\'hypokalemia\',\'hyponatremia\',\'hypercalciemie\')) as lp;" where id =14;
UPDATE preselect_rules SET sql_condition="select true from (select name from patient_problems where patient_id = ? and name in(\'parkinson\',\'lewy-bodies-dementia\',\'multiple-system-atrophy\',\'progressive-supranuclear-palsy\')) as p;" where id =15;
UPDATE preselect_rules SET sql_condition="select true from ((select patient_id, name as pn from patient_problems where patient_id = ? and name in(\'parkinson\',\'lewy-bodies-dementia\',\'multiple-system-atrophy\',\'progressive-supranuclear-palsy\')) as ppn join (select patient_id, name as po from patient_problems where patient_id = ? and name in(\'orthostatische-hypotensie\')) as ppo on ppn.patient_id = ppo.patient_id) where pn IS NOT NULL and po IS NOT NULL;" where id =16;
UPDATE preselect_rules SET sql_condition="select true from ((select patient_id, name as pn from patient_problems where patient_id = ? and name in(\'parkinson\',\'lewy-bodies-dementia\',\'multiple-system-atrophy\',\'progressive-supranuclear-palsy\')) as ppn join (select patient_id, name as po from patient_problems where patient_id = ? and name in(\'orthostatische-hypotensie\')) as ppo on ppn.patient_id = ppo.patient_id) where pn IS NOT NULL and po IS NOT NULL;" where id =18;
UPDATE preselect_rules SET sql_condition="select true from ((select patient_id, name as pn from patient_problems where patient_id = ? and name in(\'parkinson\',\'lewy-bodies-dementia\',\'multiple-system-atrophy\',\'progressive-supranuclear-palsy\')) as ppn join (select patient_id, name as po from patient_problems where patient_id = ? and name in(\'orthostatische-hypotensie\')) as ppo on ppn.patient_id = ppo.patient_id) where pn IS NOT NULL and po IS NOT NULL;" where id =20;
UPDATE preselect_rules SET sql_condition="select true from ((select patient_id, name as pn from patient_problems where patient_id = ? and name in(\'parkinson\',\'lewy-bodies-dementia\',\'multiple-system-atrophy\',\'progressive-supranuclear-palsy\')) as ppn join (select patient_id, name as po from patient_problems where patient_id = ? and name in(\'orthostatische-hypotensie\')) as ppo on ppn.patient_id = ppo.patient_id) where pn IS NOT NULL and po IS NOT NULL;" where id =23;
UPDATE preselect_rules SET sql_condition="select true from patient_problems where !(select true from patient_problems where patient_id = ? and name = \'atriumfibrilleren\' limit 1) and !(select true from patient_problems where patient_id = ? and name = \'angina-pectoris\' limit 1)  and !(select true from patient_problems where patient_id = ? and name = \'myocardinfarct\' limit 1) limit 1;" where id =24;
UPDATE preselect_rules SET sql_condition="select true from ((select patient_id, name as pn from patient_problems where patient_id = ? and name in(\'parkinson\',\'lewy-bodies-dementia\',\'multiple-system-atrophy\',\'progressive-supranuclear-palsy\')) as ppn join (select patient_id, name as po from patient_problems where patient_id = ? and name in(\'orthostatische-hypotensie\')) as ppo on ppn.patient_id = ppo.patient_id) where pn IS NOT NULL and po IS NOT NULL;" where id =25;
UPDATE preselect_rules SET sql_condition="select true from patient_labs where patient_labs.patient_id = ? AND lab_test_name = \'eGFR\' AND cast(lab_test_result as decimal(5,2)) <= 30 AND date_measured <= CURRENT_DATE() - INTERVAL 11 MONTH limit 1;" where id =28;
UPDATE preselect_rules SET sql_condition="select true from (select ATC_code from patient_medications where patient_id = ? and ATC_code in(\'N02BE01\',\'N02BE51\',\'N02BE71\',\'N02AJ01\',\'N02AJ06\',\'N02AJ13\',\'N02AJ17)) as p;" where id =29;
UPDATE preselect_rules SET sql_condition="select true from patient_problems where !(select true from patient_problems where patient_id = ? and name = \'paraplegia\' limit 1)  and !(select true from patient_problems where patient_id = ? and name = \'dwaarslaesie\' limit 1) limit 1;" where id =30;